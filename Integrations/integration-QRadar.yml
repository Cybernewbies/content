commonfields:
  id: QRadar
  version: -1
name: QRadar
display: IBM QRadar
category: Analytics & SIEM
image: data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHMAAAAfCAYAAADUdfLHAAAHgElEQVR4Ae3YA6xlWRaA4VW2bdu2bVdbZbRt27a7y7Zt27ZtvFrzJ1mT7Nnpvnicmb6VfPXeuzzJn3P2OltC+bd0z8eJUB4P4RcswVGcwXGsxCA8hRpIComIX/4DvsRohUmIgoZoIW5HCkhEwscsgjHQGFiIqpCIhIvZBsegnrOYg0/wKHriQbyLKTgB9VxCb0hE/MfsBfUcwXPICDFJkB6pICY5emAn1PMGJCL+YnaGen51IubBs1iPS1DcxHGMQUskNm/76yyehMS9SMzSOAU1t/AYBCnwnj2mOIc1mIl52A81W1EPgs64BDU30BQStyIxx0IdT0CQA8uhGIYq3rSbCIIi+AO3vPd3ch5TrEQySNyIxOwCdXwPQWZsxToUg6AAvsMOnMERzMM9EFTGASieguBpqOMRSNyIxJwKNXuQDYJBmI8UELwIxXnMxB9YgstQbEJRFMJRKOpBsAhqNiI5JHZFYlaFOl6CoCW2IysE7yEKPf0QSOGEPm4xW0IxE4JuUEdDSPRFvDSgW2bkRSqI2JCj5jQKQDAYAyDoiGOoCEEZe349FqEXBO2hWADBcCdcImyDmm8h0RYJ2RYd0Bh3orTYpVLNdAjyYS7SQDADfSGoj5V4Cb3sOcVvELwFRWs0h+IjCL6EmqUQIy/07ZKIA6qPtmgdQBs0Q05IPMuL9miNdsgCSQDVLWQztEBLdBVnUlV8DEFLDIOgPOYhERJjEKpCHH9A0R0FnCEqGxSzIOgDNfuX7fskLQTyYr+uyTigTdAQncMolIbEkx5QR2NIArgHRdAfr6M56oq3bfckBD3wKQSdLIygFt6GeGpCMQiCPViCJDiEzRC0hpqzy/Z+kgMCeaFPFydmWI6iAiQePPBfErMD6qAp6qIV2oi3UTAAgr74AILbnICN8DDEUwSKcRBsxCokwi7sgKAB1FwgYj4I5HkvptmAJVjm2A31zP+HxUyD+9AM+dETzcTuE9U8DUFXfAtBIydsPrwM8bSE4gVkgWI00uIqlkHQDmrOcHnNDoGwZvoxb6EixJMUz0Ad11HqnxLTpEZL3IcK/55mF0PN5xBUwTAIstjjiSG4G2UgjjKYhGwYCMXDKA/FHxAMgJq9REzjrZlBY5rk2AJ1NII4kqAWHsfn+Alf4RV0RnqIz9TGi/gMb6EdBPcFiZkSzfE8vsKP+BzPoZk9L45KaGbKQZABd+ML9ICExGL+DDWzIUiCH5ENgifQGoJkRowf9SJOISNehqI3BN9BzQKICSumWQx11IGYPBgHDWArakAcafADFL4ReDJAzCpYAQ1gLgpAzCyoGYp8WAM1U8KNOdBdx1AcgsfRF4LceC2EXZuyOIiByIGz9nc6sw9qPvuPmP3/MmYFCHwZsR9qziCPE2SZ9zlbsQC7oI69yAwxw6Dee68gCoqT9pgfsyAOQ80NrMNC93Ez2Y9ppmKe/9pwY5bDDah5B4Ls+BwpIciCFJAg0iA1JnoT8n1QRw3vJvivYrZDXhQ1RVAJg6COX7yxXR3vQEwiDIY6GkLQDerYg07Ii6qYCTV+zB+hjnsgJgOWQM1VFIMfMwqKG9iIlfg8rJj8JzasqDmCAhC0Qh9ImArhNGZAkBproWYVEgeKaa7hiueWdwYMQlqI6YllmIvJyAlx3A51tIJghve9leEPHBv+Zp3+DIsxH0OQCuL40L/i+DHNKbSGmEQIO2YrqGMYxJRCEkiYiiA3BG9DHQ9AgsYMbjcqQYJIheyojgVQRzMk8S6HMyDwvRLiNJsIaZAbzbEtxJi9Ib6wYlrQ36GOtyCxoBfUMQ8CP2ao95lHoI5LqAF/2u2CP7EUe3ER6rMg2XAZal6AwNcoQMwM6ItRWIWDuAo1wWJeRpHYilkA+6H++hkD/REFNedRLUjMYNNsGvwKdYyHmNxYAfXcwC7MgR8kJ65CzRMQ+Or+TcwaOAD1XMN6rAsh5kGki5WYFrQJrkIdU1AAEobM+BXq6QGJSUxT1DuT9iI1BEOhju9RCwUgaAt1NEUanIGaHyHw3Q11NIBgjbeB8TIqIw8Eb4YQcx/SxFpMC9oRV6COc/gKJb3BxZcfr+Mo1HEd90NiKab/2nPIijQ4GmTt6wd1tIB4Z89+ZIR4hkAdtZEH16DmDYjn6/iPaWxDfTvUcw3rMQTv4xW8g9+xApeg8I1HVwv6AHrg3uX7PkkPAdt5YW8azIaaK8iP9N4ZNiHI+9xp9l2o41sk9ja3/TWwFgojCmqegTiyYHvCxDR2n/kNoqAxdAvqucoGezF/oz2MmD9CTRTKQrDeW7M+QifcbXHV0xaCnDgEdazEdxiPS1BPPaTGcag5jefREX2wAuqpGC8xfTaw/IBz0Njix3wh/JjPQh13QHAnNICd3hnWA2Lae2uxb6wXtREE70B9Jgr+cNQIfswDSBtXMf2oedAd72EU5mFZNK3EAiLmdWIm4Xt+xgLMwcwgo3pdLMIsLMVzEHO7PXcCZ3AcK/AcimA05mIpHoI4qmMEDuAMTmEN+qI4pmMOFqISBEnxONbhFM7gMObhXtTHPMzGErSF4ENvsyElJLr+BYNjupf20vh5AAAAAElFTkSuQmCC
description: Get incidents and search QRadar
detaileddescription: Get incidents and search QRadar
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: Username
  name: credentials
  defaultvalue: ""
  type: 9
  required: false
- display: Authentication token
  name: token
  defaultvalue: ""
  type: 4
  required: false
- display: Query to fetch offenses
  name: query
  defaultvalue: ""
  type: 0
  required: false
- display: Number of offenses to pull per API call
  name: offensesPerCall
  defaultvalue: "50"
  type: 0
  required: false
- display: Trust any certificate (unsecure)
  name: insecure
  defaultvalue: "true"
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: "true"
  type: 8
  required: false
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
script:
  script: |-
    import sys, os, requests, traceback, datetime
    from time import sleep
    from requests.exceptions import HTTPError

    # Header names transformation maps
    # Format: {'OldName': 'NewName'}

    OFFENSES_NAMES_MAP = {'follow_up': 'Followup', 'id': 'ID', 'description': 'Description', 'source_address': 'SourceAddress', 'destination_address': 'DestinatioAddress', 'start_time': 'StartTime', 'event_count': 'EventCount', 'magnitude': 'Magnitude', 'last_updated_time': 'LastUpdatedTime', 'offense_type': 'OffenseType'}
    SINGLE_OFFENSE_NAMES_MAP = {'credibility': 'Credibility', 'relevance': 'Relevance', 'severity': 'Severity', 'assigned_to': 'AssignedTo', 'destination_networks': 'DestinationHostname', 'status': 'Status', 'closing_user': 'ClosingUser', 'closing_reason': 'ClosingReason', 'close_time': 'CloseTime', 'categories': 'Categories', 'follow_up': 'Followup', 'id': 'ID', 'description': 'Description', 'source_address': 'SourceAddress', 'destination_address': 'DestinatioAddress', 'start_time': 'StartTime', 'event_count': 'EventCount', 'flow_count': 'FlowCount', 'offense_source': 'OffenseSource', 'magnitude': 'Magnitude', 'last_updated_time': 'LastUpdatedTime', 'offense_type': 'OffenseType', 'protected': 'Protected'}
    SEARCH_ID_NAMES_MAP = {'search_id': 'ID'}
    ASSET_PROPERTIES_NAMES_MAP = {'Unified Name': 'Name', 'CVSS Collateral Damage Potential': 'AggregatedCVSSScore', 'Weight': 'Weight'} #TODO: Add in missing parts: 'QRadar.Assets.LastUser'
    ASSET_PROPERTIES_ENDPOINT_NAMES_MAP = {'Primary OS ID': 'Endpoint.OS'}
    FULL_ASSET_PROPERTIES_NAMES_MAP = {'Compliance Notes': 'ComplianceNotes', 'Compliance Plan': 'CompliancePlan', 'CVSS Collateral Damage Potential': 'CollateralDamagePotential', 'Location': 'QRadar.Assets.Location'} #TODO: add in missing parts: QRadar.Assets.GroupName, QRadar.Assets.Vulnerabilities, QRadar.Assets.SwitchID, QRadar.Assets.SwitchPort
    FULL_ASSET_PROPERTIES_ENDPOINT_NAMES_MAP = {}

    #TODO: COMPLETE THIS

    ''' GLOBAL VARS '''
    SERVER = demisto.params()['server'][:-1] if demisto.params()['server'].endswith('/') else demisto.params()['server']
    USERNAME = demisto.params().get('credentials').get('identifier')
    PASSWORD = demisto.params().get('credentials').get('password')
    TOKEN = demisto.params().get('token')
    USE_SSL = not demisto.params().get('insecure', False)
    CUSTOM_HEADERS = demisto.args().get('headers')
    AUTH_HEADERS = {'SEC': str(TOKEN), 'Content-Type':  'application/json'}

    if not TOKEN and not PASSWORD:
        raise Exception('Either credentials or auth token should be provided.')

    if CUSTOM_HEADERS:
        CUSTOM_HEADERS = CUSTOM_HEADERS.split(',')

    if not demisto.params()['proxy']:
        del os.environ['HTTP_PROXY']
        del os.environ['HTTPS_PROXY']
        del os.environ['http_proxy']
        del os.environ['https_proxy']

    # Utility methods

    def filter_dict_null(d):
        if isinstance(d, dict):
            return dict((k, v) for k, v in d.items() if v is not None)
        return d

    def filter_dict_nonintersection_key_to_value(d1, d2):
        if isinstance(d1, list):
            return map(lambda x: filter_dict_nonintersection_key_to_value(x, d2), d1)
        elif isinstance(d1, dict) and isinstance(d2, dict):
            d2values = d2.values()
            return dict((k,v) for k,v in d1.items() if k in d2values)
        return d1

    #todo improve this (better implementation). goal: DICT VALUES TO COMMA SPEREATED LIST
    def dict_to_string(dic):
        res = ''
        for k,v in dic.iteritems():
            res = res + str(v) + ','
        return res[:-1]

    def get_entry_for_object(title, obj, headers=None, contextKey=None):
        if len(obj) == 0:
            return "There is no output result"
        obj = filter_dict_null(obj)
        if isinstance(obj, list):
            obj = map(filter_dict_null, obj)
        if headers and isinstance(obj, dict):
            headers = list(set(headers).intersection(set(obj.keys())))
        ec = { contextKey: obj } if contextKey else obj
        return {
            'Type': entryTypes['note'],
            'Contents': obj,
            'ContentsFormat': formats['json'],
            'ReadableContentsFormat': formats['markdown'],
            'HumanReadable': tableToMarkdown(title, obj, headers),
            'EntryContext': ec
        }

    # change the keys of a dictionary according to a conversion map
    # trans_map - { 'OldKey': 'NewKey', ...}
    # camelize - change all keys from snake_case to CamelCase
    def replace_keys(src, trans_map):
        def replace(key, trans_map):
            if key in trans_map:
                return trans_map[key]
            return key

        if isinstance(src, list):
            return map(lambda x: replace_keys(x, trans_map), src)
        if trans_map:
            src = {replace(k, trans_map): v for k,v in src.iteritems()}
        return src

    def epoch_to_ISO(ms_passed_since_epoch):
        return datetime.datetime.fromtimestamp(ms_passed_since_epoch/1000.0).strftime(("%Y-%m-%d %H:%M:%SZ"))

    def enrich_offense_result(response):
        enrich_offense_res_with_source_and_destination_address(response)
        # Convert epoch to iso
        for offense in response:
            if 'start_time' in offense:
                offense['start_time'] = epoch_to_ISO(offense['start_time'])
            if 'last_updated_time' in offense:
                offense['last_updated_time'] = epoch_to_ISO(offense['last_updated_time'])
        return None

    def enrich_offense_res_with_source_and_destination_address(response):
        src_ids, dst_ids = extract_source_and_destination_dict(response)
        enrich_source_addresses_dict(src_ids)
        enrich_destination_addresses_dict(dst_ids)
        for offense in response:
            if isinstance(offense['source_address_ids'], list):
                for i in range(len(offense['source_address_ids'])):
                    offense['source_address_ids'][i] = src_ids[offense['source_address_ids'][i]]
            if isinstance(offense['local_destination_address_ids'], list):
                for i in range(len(offense['local_destination_address_ids'])):
                    offense['local_destination_address_ids'][i] = dst_ids[offense['local_destination_address_ids'][i]]
        return None

    def extract_source_and_destination_dict(response):
        src_ids = {}
        dst_ids = {}
        for offense in response:
            if isinstance(offense['source_address_ids'], list):
                for source_id in offense['source_address_ids']:
                    src_ids[source_id] = source_id
            if isinstance(offense['local_destination_address_ids'], list):
                for destination_id in offense['local_destination_address_ids']:
                    dst_ids[destination_id] = destination_id
        return src_ids, dst_ids

    def enrich_source_addresses_dict(src_ids):
        src_ids_str = dict_to_string(src_ids)
        source_url = '{0}/api/siem/source_addresses?filter=id in ({1})'.format(SERVER, src_ids_str)
        src_res = send_request('GET', source_url, AUTH_HEADERS)
        for src_adr in src_res:
            src_ids[src_adr['id']] = src_adr['source_ip']
        return None

    def enrich_destination_addresses_dict(dst_ids):
        dst_ids_str = dict_to_string(dst_ids)
        destination_url = '{0}/api/siem/local_destination_addresses?filter=id in ({1})'.format(SERVER, dst_ids_str)
        headers = {'Content-Type': 'application/json', "SEC": str(TOKEN)}
        dst_res = send_request('GET', destination_url, AUTH_HEADERS)
        for dst_adr in dst_res:
            dst_ids[dst_adr['id']] = dst_adr['local_destination_ip']
        return None

    def send_request(method, url, headers=AUTH_HEADERS, params=None):
        try:
            res = requests.request(method, url, headers=headers, params=params, verify=USE_SSL)
            res.raise_for_status()
        except HTTPError, e:
            return_error(res.json())
        return res.json()

    def create_assets_result(assets, full_values=False):
        trans_assets = {}
        if isinstance(assets, list):
            for asset in assets:
                populate_asset_result(asset, trans_assets, full_values)
        else:
            populate_asset_result(assets, trans_assets, full_values)
        return trans_assets

    def populate_asset_result(asset, trans_asset, full_values):
        asset_key = 'QRadar.Asset(val.ID === {0}).'.format(asset['id']) #TODO: Improve this flow, as it can create values of arrays after second call
        trans_asset[asset_key + 'ID'] = asset['id']
        trans_asset['Endpoint.IPAddress'] = []
        trans_asset['Endpoint.MACAddress'] = []
        for interface in asset['interfaces']:
            if full_values:
                trans_asset['Endpoint.MACAddress'].append(interface['mac_address'])
            for ip_address in interface['ip_addresses']:
                trans_asset['Endpoint.IPAddress'].append(ip_address['value'])
        # if full_values:
            # Try to get DNS name, if fails will pass. TODO: Complete implementation
            # try:
            #     trans_asset['Endpoint.Domain'] = get_domain_name(asset['domain_id'])
            # except:
            #     pass

        # Adding values found in properties of the asset
        enrich_dict_using_asset_properties(asset, trans_asset, asset_key, full_values)

    def enrich_dict_using_asset_properties(asset, trans_asset, asset_key, full_values):
        for prop in asset['properties']:
            if prop['name'] in ASSET_PROPERTIES_NAMES_MAP:
                trans_asset[asset_key + ASSET_PROPERTIES_NAMES_MAP[prop['name']]] = prop['value']
            elif prop['name'] in ASSET_PROPERTIES_ENDPOINT_NAMES_MAP:
                trans_asset[ASSET_PROPERTIES_ENDPOINT_NAMES_MAP[prop['name']]] = prop['value']
            elif full_values:
                if prop['name'] in FULL_ASSET_PROPERTIES_NAMES_MAP:
                    trans_asset[asset_key + FULL_ASSET_PROPERTIES_NAMES_MAP[prop['name']]] = prop['value']
                elif prop['name'] in FULL_ASSET_PROPERTIES_ENDPOINT_NAMES_MAP:
                    trans_asset[FULL_ASSET_PROPERTIES_ENDPOINT_NAMES_MAP[prop['name']]] = prop['value']
        return None

    # Request/Response methods
    def send_get_offenses_request(_range, _filter='', _fields=''):
        full_url = '{0}/api/siem/offenses'.format(SERVER)
        params = {{"filter": _filter}} if _filter else {}
        headers = dict(AUTH_HEADERS)
        if _fields:
            params.fileds = _fields
        if _range:
            headers['Range'] = 'items={0}'.format(_range)
        return send_request('GET', full_url, headers, params)

    def send_get_offense_by_id_request(offense_id, _filter='', _fields=''):
        full_url = '{0}/api/siem/offenses/{1}'.format(SERVER, offense_id)
        demisto.info(full_url)
        params = {"filter": _filter} if _filter else {}
        headers = dict(AUTH_HEADERS)
        if _fields:
            params.fileds = _fields
        return send_request('GET', full_url, headers, params)

    def send_update_offense_request(offense_id):
        url = '{0}/api/siem/offenses/{1}'.format(SERVER, offense_id)
        return send_request('POST', url, params=demisto.args())

    def send_search_request():
        url = '{0}/api/ariel/searches'.format(SERVER)
        return send_request('POST', url, AUTH_HEADERS, params=demisto.args())

    def send_get_search_request(search_id):
        url = '{0}/api/ariel/searches/{1}'.format(SERVER, str(search_id))
        return send_request('GET', url, AUTH_HEADERS)

    def send_get_search_results_request(search_id):
        url = '{0}/api/ariel/searches/{1}/results'.format(SERVER, str(search_id))
        return send_request('GET', url, AUTH_HEADERS)

    def send_get_assets(_range='', _filter='', _fields=''):
        url = '{0}/api/asset_model/assets'.format(SERVER)
        params = {"filter": _filter} if _filter else {}
        headers = dict(AUTH_HEADERS)
        if _fields:
            params.fileds = _fields
        if _range:
            headers['Range'] = 'items={0}'.format(_range)
        return send_request('GET', url, headers, params)

    # Command methods
    def test_module():
        if not send_get_offenses_request('0-0'):
            return_error('Encoutered error while trying to fetch offenses from sever.') #todo: adjust this with generic implementation of get offenses
        return 'ok'

    def get_offenses():
        res = send_get_offenses_request(demisto.args().get('range'), demisto.args().get('filter'), demisto.args().get('fields'))
        enrich_offense_result(res)
        res = filter_dict_nonintersection_key_to_value(replace_keys(res, OFFENSES_NAMES_MAP), OFFENSES_NAMES_MAP)
        return get_entry_for_object('QRadar offenses', res, CUSTOM_HEADERS, 'QRadar.Offense(val.ID === obj.ID)') #TODO: Make sure this key will act properly for lists

    def get_offense_by_id():
        offense_id = demisto.args().get('offense_id')
        res = send_get_offense_by_id_request(offense_id, demisto.args().get('filter'), demisto.args().get('fields'))
        enrich_offense_result(res)
        res = filter_dict_nonintersection_key_to_value(replace_keys(res, SINGLE_OFFENSE_NAMES_MAP), SINGLE_OFFENSE_NAMES_MAP)
        return get_entry_for_object('QRadar Offenses', res, CUSTOM_HEADERS, 'QRadar.Offense(val.ID === obj.ID)')

    def update_offense():
        args = demisto.args()
        if not 'closing_reason_id' in args and 'CLOSED' == args.get('status'):
            raise ValueError('Invalid input - must provide closing reason id (may use "qradar-get-closing-reasons" command to get them) to close offense')
        offense_id = args.get('offense_id')
        res = send_update_offense_request(offense_id)
        res = filter_dict_nonintersection_key_to_value(replace_keys(res, SINGLE_OFFENSE_NAMES_MAP), SINGLE_OFFENSE_NAMES_MAP)
        return get_entry_for_object('QRadar Offense', res, CUSTOM_HEADERS, 'QRadar.Offense(val.ID === obj.ID)')

    def post_search():
        res = send_search_request()
        res = filter_dict_nonintersection_key_to_value(replace_keys(res, SEARCH_ID_NAMES_MAP), SEARCH_ID_NAMES_MAP)
        return get_entry_for_object('QRadar Search', res, CUSTOM_HEADERS, 'QRadar.Search(val.ID === obj.ID)')

    def get_search():
        res = send_get_search_request(demisto.args().get('search_id'))
        res = replace_keys(res, SEARCH_ID_NAMES_MAP)
        return get_entry_for_object('QRadar Search Info', res, CUSTOM_HEADERS, 'QRadar.Search(val.ID === obj.ID)')

    def get_search_results():
        search_id = demisto.args().get('search_id')
        res = send_get_search_results_request(search_id)
        return get_entry_for_object('QRadar Search Results', res, CUSTOM_HEADERS, 'QRadar.Search(val.ID === {0}).Result'.format(search_id))

    def get_assets():
        res = send_get_assets(demisto.args().get('range'), demisto.args().get('filter'), demisto.args().get('fields'))
        res = create_assets_result(res)
        return get_entry_for_object('QRadar Assets', res, CUSTOM_HEADERS)

    def get_asset_by_id():
        _filter = "id=" + demisto.args().get('asset_id')
        res = send_get_assets(_filter=_filter)
        res = create_assets_result(res, full_values=True)
        return get_entry_for_object('QRadar Asset', res, CUSTOM_HEADERS)

    def get_closing_reasons():
        res = send_get_closing_reasons()

    # Command selector
    if demisto.command() == 'test-module':
        demisto.results(test_module())
    elif demisto.command() == 'fetch-incidents':
        demisto.results(test_module())
    elif demisto.command() == 'qradar-offenses':
        demisto.results(get_offenses())
    elif demisto.command() == 'qradar-offense-by-id':
        demisto.results(get_offense_by_id())
    elif demisto.command() == 'qradar-update-offense':
        demisto.results(update_offense())
    elif demisto.command() == 'qradar-searches':
        demisto.results(post_search())
    elif demisto.command() == 'qradar-get-search':
        demisto.results(get_search()) #TODO: Sit with Michal again to decide what output should be here
    elif demisto.command() == 'qradar-get-search-results':
        demisto.results(get_search_results())
    elif demisto.command() == 'qradar-get-assets':
        demisto.results(get_assets())
    elif demisto.command() == 'qradar-get-asset-by-id':
        demisto.results(get_asset_by_id())
    elif demisto.command() == 'qradar-get-closing-reasons':
        demisto.results(get_closing_reasons())
    elif demisto.command() == 'qradar-get-note':
        demisto.results(get_note())
    elif demisto.command() == 'qradar-create-note':
        demisto.results(create_note())
    elif demisto.command() == 'qradar-get-reference-by-name':
        demisto.results(get_reference_by_name())
    elif demisto.command() == 'qradar-get-events':
        demisto.results(get_reference_by_name())
  type: python
  commands:
  - name: qradar-offenses
    arguments:
    - name: filter
      description: Query to filter offenses
    - name: fields
      description: 'Fields to filter in '
    - name: range
      description: Number of results in return
    - name: headers
      description: Table headers
    outputs:
    - contextPath: QRadar.Offense.Followup
      description: Offense followup.
    - contextPath: QRadar.Offense.ID
      description: The ID of the offense.
    - contextPath: QRadar.Offense.Description
      description: The description of the offense.
    - contextPath: QRadar.Offense.SourceAddress
      description: TODO_REQS_ANOTHER_CALL_TO_API(url + /siem/source_addresses?filter=id
        in ({0},{1})) The source addresses that are associated with the offense.
    - contextPath: QRadar.Offense.DestinatioAddress
      description: TODO_REQS_ANOTHER_CALL_TO_API(url + siem/local_destination_addresses?filter=id
        in ({0},{1})) The destination addresses that are associated with the offense.
    - contextPath: QRadar.Offense.StartTime
      description: CONVERT_TO_ISO The time (ISO) when the offense was started.
    - contextPath: QRadar.Offense.EventCount
      description: The number of events that are associated with the offense.
    - contextPath: QRadar.Offense.FlowCount
      description: The number of flows that are associated with the offense.
    - contextPath: QRadar.Offense.OffenseSource
      description: The source of the offense.
    - contextPath: QRadar.Offense.Magnitude
      description: The magnitude of the offense.
    - contextPath: QRadar.Offense.LastUpdatedTime
      description: CONVERT_TO_ISO The time (ISO) when the offense was last updated.
    - contextPath: QRadar.Offense.OffenseType
      description: A number that represents the offense type
    description: Gets offenses from QRadar
  - name: qradar-offense-by-id
    arguments:
    - name: offense_id
      required: true
      default: true
      description: Offense ID
    - name: filter
      description: Query to filter offenses
    - name: fields
      description: 'Fields to filter in '
    - name: range
      description: Number of results in return
    - name: headers
      description: Table headers
    outputs:
    - contextPath: QRadar.Offense.Credibility
      description: The credibility of the offense
    - contextPath: QRadar.Offense.Relevance
      description: The relevance of the offense
    - contextPath: QRadar.Offense.Severity
      description: The severity of the offense
    - contextPath: QRadar.Offense.SourceAddress
      description: TODO_REQS_ANOTHER_CALL_TO_API(url + /siem/source_addresses?filter=id
        in ({0},{1})) The source addresses that are associated with the offense.
    - contextPath: QRadar.Offense.DestinatioAddress
      description: TODO_REQS_ANOTHER_CALL_TO_API(url + siem/local_destination_addresses?filter=id
        in ({0},{1})) The destination addresses that are associated with the offense.
    - contextPath: QRadar.Offense.AssignedTo
      description: The user the offense is assigned to.
    - contextPath: QRadar.Offense.StartTime
      description: CONVERT_TO_ISO The time (ISO) when the offense was started.
    - contextPath: QRadar.Offense.ID
      description: The ID of the offense.
    - contextPath: QRadar.Offense.DestinationHostname
      description: Destintion hostname
    - contextPath: QRadar.Offense.Description
      description: The description of the offense.
    - contextPath: QRadar.Offense.EventCount
      description: The number of events that are associated with the offense.
    - contextPath: QRadar.Offense.OffenseSource
      description: The source of the offense.
    - contextPath: QRadar.Offense.Status
      description: The status of the offense. One of "OPEN", "HIDDEN", or "CLOSED".
    - contextPath: QRadar.Offense.Magnitude
      description: The magnitude of the offense.
    - contextPath: QRadar.Offense.ClosingUser
      description: The user that closed the offense
    - contextPath: QRadar.Offense.ClosingReason
      description: ID_TO_BE_REVIEWED The offense closing reason.
    - contextPath: QRadar.Offense.CloseTime
      description: CONVERT_TO_ISO The time when the offense was closed.
    - contextPath: QRadar.Offense.LastUpdatedTime
      description: CONVERT_TO_ISO The time (ISO) when the offense was last updated.
    - contextPath: QRadar.Offense.Categories
      description: Event categories that are associated with the offense.
    - contextPath: QRadar.Offense.FlowCount
      description: The number of flows that are associated with the offense.
    - contextPath: QRadar.Offense.FollowUp
      description: Offense followup.
    - contextPath: QRadar.Offense.OffenseType
      description: A number that represents the offense type
    description: Gets offense with matching offense ID from qradar
  - name: qradar-searches
    arguments:
    - name: query_expression
      required: true
      default: true
      description: The query expressions in AQL (for more information about Ariel
        Query Language please review "https://www.ibm.com/support/knowledgecenter/en/SS42VS_7.3.0/com.ibm.qradar.doc/c_aql_intro.html")
    - name: headers
      description: Table headers
    outputs:
    - contextPath: QRadar.Search.id
      description: Search ID
    description: Searches in QRadar
  - name: qradar-get-search
    arguments:
    - name: search_id
      required: true
      default: true
      description: The search id
    - name: headers
      description: Table headers
    description: Gets a specific search id
  - name: qradar-get-search-results
    arguments:
    - name: search_id
      required: true
      default: true
      description: The search id
    - name: range
      description: Number of results in return
    - name: headers
      description: Table headers
    description: Gets search results
  - name: qradar-update-offense
    arguments:
    - name: offense_id
      required: true
      default: true
      description: The ID of the offense to update
    - name: protected
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Set to true to protect the offense
    - name: follow_up
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Set to true to set the follow up flag on the offense
    - name: status
      auto: PREDEFINED
      predefined:
      - OPEN
      - HIDDEN
      - CLOSED
      description: The new status for the offense
    - name: closing_reason_id
      description: 'The ID of a closing reason. You must provide a valid closing_reason_id
        when you close an offense. TODO: System closing_reasons are: (2) False-Positive,
        Tuned (1) Non-Issues (3) Policy Violation TODO:  use api/siem/offense_closing_reasons
        to convert from name to id - if the name doesn''t exist then throw an error'
    - name: assigned_to
      description: A user to assign the offense to
    - name: headers
      description: Table headers
    - name: fields
      description: Use this parameter to specify which fields you would like to get
        back in the response. Fields that are not named are excluded. Specify subfields
        in brackets and multiple fields in the same object are separated by commas
    outputs:
    - contextPath: QRadar.Offense.Followup
      description: Offense followup.
    - contextPath: QRadar.Offense.ID
      description: The ID of the offense.
    - contextPath: QRadar.Offense.Description
      description: The description of the offense.
    - contextPath: QRadar.Offense.SourceAddress
      description: TODO_REQS_ANOTHER_CALL_TO_API The source addresses that are associated
        with the offense.
    - contextPath: QRadar.Offense.DestinatioAddress
      description: TODO_REQS_ANOTHER_CALL_TO_API The destination addresses that are
        associated with the offense.
    - contextPath: QRadar.Offense.StartTime
      description: CONVERT_TO_ISO The time (ISO) when the offense was started.
    - contextPath: QRadar.Offense.EventCount
      description: The number of events that are associated with the offense.
    - contextPath: QRadar.Offense.FlowCount
      description: The number of flows that are associated with the offense.
    - contextPath: QRadar.Offense.OffenseSource
      description: The source of the offense.
    - contextPath: QRadar.Offense.Magnitude
      description: The magnitude of the offense.
    - contextPath: QRadar.Offense.LastUpdatedTime
      description: CONVERT_TO_ISO The time (ISO) when the offense was last updated.
    - contextPath: QRadar.Offense.OffenseType
      description: A number that represents the offense type
    - contextPath: QRadar.Offense.Protected
      description: Is the offense protected
    description: Update an offense
  - name: qradar-get-assets
    arguments:
    - name: range
      description: Number of results in return
    - name: fields
      description: Fields to filter in
    - name: filter
      description: Query to filter offenses
    - name: headers
      description: Table headers
    outputs:
    - contextPath: QRadar.Assets.ID
      description: The ID of the asset.
    - contextPath: Endpoint.IPAddress
      description: IP address of the asset.
    - contextPath: QRadar.Assets.Name
      description: Name of the asset.
    - contextPath: Endpoint.OS
      description: Asset OS.
    - contextPath: QRadar.Assets.AggregatedCVSSScore
      description: CVSSScore.
    - contextPath: QRadar.Assets.LastUser
      description: Last user.
    - contextPath: QRadar.Assets.Weight
      description: Asset weight.
    description: List all assets found in the model
  - name: qradar-get-asset-by-id
    arguments:
    - name: asset_id
      required: true
      default: true
      description: The ID of the requested asset.
    outputs:
    - contextPath: QRadar.Assets.ID
      description: The ID of the asset.
    - contextPath: Endpoint.MACAddress
      description: Asset MAC address.
    - contextPath: Endpoint.IPAddress
      description: It's in ip_addresses - value
    - contextPath: QRadar.Assets.ComplianceNotes
      description: value
    - contextPath: QRadar.Assets.CompliancePlan
      description: value
    - contextPath: QRadar.Assets.CollateralDamagePotential
      description: Collateral damage potential.
    - contextPath: QRadar.Assets.AggregatedCVSSScore
      description: CVSSScore.
    - contextPath: QRadar.Assets.Name
      description: Name of the asset.
    - contextPath: QRadar.Assets.GroupName
      description: Name of the asset's group.
    - contextPath: Endpoint.Domain
      description: TODO, This is for DNS name, can be reached via https://13.58.1.138/api/ariel/searches?query_expression=SELECT
        DOMAINNAME(1) AS 'Domain name' FROM events GROUP BY 'Domain name' -> https://13.58.1.138/api/ariel/searches/{search
        id}/results
    - contextPath: Endpoint.OS
      description: Asset OS.
    - contextPath: QRadar.Assets.Weight
      description: Asset weight.
    - contextPath: QRadar.Assets.LastUser
      description: Last user.
    - contextPath: QRadar.Assets.Vulnerabilities
      description: Vulnerabilities.
    - contextPath: QRadar.Assets.Location
      description: Location.
    - contextPath: QRadar.Assets.Description
      description: The asset description.
    - contextPath: QRadar.Assets.SwitchID
      description: Switch ID
    - contextPath: QRadar.Assets.SwitchPort
      description: Switch port.
    description: Retrieves the asset by id
  - name: qr-searches
    deprecated: true
    arguments:
    - name: query_expression
      required: true
      default: true
      description: The query expressions in AQL
    - name: headers
      description: Table headers
    description: Searches in QRadar
  - name: qr-get-search
    deprecated: true
    arguments:
    - name: search_id
      required: true
      default: true
      description: The search id
    - name: headers
      description: Table headers
    description: Gets a specific search id
  - name: qr-get-search-results
    deprecated: true
    arguments:
    - name: search_id
      required: true
      default: true
      description: The search id
    - name: range
      description: Number of results in return
    - name: headers
      description: Table headers
    description: Gets search results
  - name: qr-update-offense
    deprecated: true
    arguments:
    - name: offense_id
      required: true
      default: true
      description: The ID of the offense to update
    - name: protected
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Set to true to protect the offense
    - name: follow_up
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Set to true to set the follow up flag on the offense
    - name: status
      auto: PREDEFINED
      predefined:
      - OPEN
      - HIDDEN
      - CLOSED
      description: he new status for the offense
    - name: closing_reason_id
      description: The ID of a closing reason. You must provide a valid closing_reason_id
        when you close an offense
    - name: assigned_to
      description: A user to assign the offense to
    - name: headers
      description: Table headers
    - name: fields
      description: Use this parameter to specify which fields you would like to get
        back in the response. Fields that are not named are excluded. Specify subfields
        in brackets and multiple fields in the same object are separated by commas
    description: Update an offense
  - name: qr-get-assets
    deprecated: true
    arguments:
    - name: range
      description: Number of results in return
    - name: fields
      description: Fields to filter in
    - name: filter
      description: Query to filter offenses
    - name: headers
      description: Table headers
    description: List all assets found in the model
  - name: qr-offenses
    deprecated: true
    arguments:
    - name: filter
      description: Query to filter offenses
    - name: fields
      description: 'Fields to filter in '
    - name: range
      description: Number of results in return
    - name: headers
      description: Table headers
    description: Gets offenses from qradar
  - name: qradar-get-closing-reasons
    arguments:
    - name: include_reserved
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If true, reserved closing reasons are included in the response
      defaultValue: "true"
    - name: include_deleted
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: If true, deleted closing reasons are included in the response
      defaultValue: "true"
    - name: fields
      description: Use this parameter to specify which fields you would like to get
        back in the response
    - name: filter
      description: This parameter is used to restrict the elements in a list base
        on the contents of various fields
    - name: range
      description: Number of results in return
    description: Get closing reasons
  - name: qradar-create-note
    arguments:
    - name: offense_id
      required: true
      default: true
      description: The offense ID to add the note to
    - name: note_text
      required: true
      description: The note text
    - name: fields
      description: Use this parameter to specify which fields you would like to get
        back in the response. Fields that are not named are excluded. Specify subfields
        in brackets and multiple fields in the same object are separated by commas
    - name: headers
      description: Table headers
    description: Create a note on an offense
  - name: qradar-get-note
    arguments:
    - name: offense_id
      required: true
      default: true
      description: The offense ID to retrieve the note from
    - name: note_id
      required: true
      description: The note ID
    - name: fields
      description: Use this parameter to specify which fields you would like to get
        back in the response. Fields that are not named are excluded. Specify subfields
        in brackets and multiple fields in the same object are separated by commas
    - name: headers
      description: Table headers
    description: Retrieve a note for an offense
  - name: qradar-get-reference-by-name
    arguments:
    - name: ref_name
      required: true
      default: true
      description: The name of the requestered reference.
    outputs:
    - contextPath: QRadar.Reference.Name
      description: The name of the reference.
    - contextPath: QRadar.Reference.CreationTime
      description: The creation time (ISO) of the reference.
    - contextPath: QRadar.Reference.ElementType
      description: Reference element type.
    - contextPath: QRadar.Reference.NumberOfElements
      description: Number of elements
    - contextPath: QRadar.Reference.TimeToLive
      description: Reference time to live.
    - contextPath: QRadar.Reference.TimeoutType
      description: Reference timeout type
    description: Information about the reference set that had data added or updated.
      This returns information set but not the contained data. This feature is supported
      from version 8.1 and upward.
  - name: qradar-get-events
    arguments: []
    description: TO BE IMPLEMENTED
  isfetch: true
  runonce: false
releaseNotes: "-"
